<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Egenkontroll N√¶ringsbygg</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root {
      --bg: #f4f6f9;
      --card: #fff;
      --primary: #4a90e2;
      --accent: #50e3c2;
      --text: #333;
      --shadow: rgba(0, 0, 0, 0.05);
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }
    header { background: var(--primary); color: #fff; padding: 1rem; text-align: center; }
    .container { max-width: 800px; margin: auto; padding: 1rem; }
    .card {
      background: var(--card);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px var(--shadow);
    }
    .card h2 {
      display: flex;
      align-items: center;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }
    .card h2 i { margin-right: 0.5rem; color: var(--accent); }
    label {
      display: flex;
      align-items: center;
      margin: 0.4rem 0;
    }
    input[type="checkbox"], input[type="date"], input[type="text"] {
      margin-right: 0.75rem;
    }
    input[type="text"], input[type="date"] {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: vertical;
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 1rem;
    }
    button {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 5px;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { opacity: 0.9; }
    @media (max-width: 600px) {
      .buttons { flex-direction: column; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Egenkontroll N√¶ringsbygg</h1>
  </header>

  <div class="container">
    <form id="form">

      <!-- Kontrollinformasjon -->
      <div class="card">
        <h2><i class="fa-solid fa-calendar"></i> Kontrollinformasjon</h2>
        <label>Dato for kontroll:<br />
          <input type="date" name="kontrolldato" required />
        </label>
        <label>Utf√∏rt av (signatur):<br />
          <input type="text" name="signatur" placeholder="Navn / signatur" required />
        </label>
      </div>

      <!-- Seksjonene 1‚Äì6 -->
      <div class="card">
        <h2><i class="fa-solid fa-building"></i> 1. Bygningsmessig tilstand</h2>
        <label><input type="checkbox" name="bygg1"> Fasade og yttervegger er fri for skader</label>
        <label><input type="checkbox" name="bygg2"> Tak er tett, ingen lekkasjer</label>
        <label><input type="checkbox" name="bygg3"> Vinduer og d√∏rer lukker tett</label>
        <label><input type="checkbox" name="bygg4"> R√∏mningsveier er frie og merket</label>
        <label><input type="checkbox" name="bygg5"> Trapper og rekkverk er i god stand</label>
      </div>

      <div class="card">
        <h2><i class="fa-solid fa-fire"></i> 2. Brannsikkerhet</h2>
        <label><input type="checkbox" name="brann1"> Brannalarmanlegg fungerer og er testet</label>
        <label><input type="checkbox" name="brann2"> R√∏ykvarslere er operative</label>
        <label><input type="checkbox" name="brann3"> Slokkeutstyr er kontrollert</label>
        <label><input type="checkbox" name="brann4"> Branninstruks og r√∏mningsplan er synlig</label>
        <label><input type="checkbox" name="brann5"> N√∏dlys fungerer</label>
      </div>

      <div class="card">
        <h2><i class="fa-solid fa-bolt"></i> 3. Elektrisk anlegg</h2>
        <label><input type="checkbox" name="el1"> Sikringsskap tilgjengelig og merket</label>
        <label><input type="checkbox" name="el2"> Ingen skader p√• ledninger</label>
        <label><input type="checkbox" name="el3"> Kontakter er hele og jordet</label>
        <label><input type="checkbox" name="el4"> Jordfeilbryter er testet nylig</label>
        <label><input type="checkbox" name="el5"> N√∏dbelysning fungerer</label>
      </div>

      <div class="card">
        <h2><i class="fa-solid fa-wind"></i> 4. VVS og ventilasjon</h2>
        <label><input type="checkbox" name="vvs1"> Ingen lekkasjer p√• r√∏r</label>
        <label><input type="checkbox" name="vvs2"> Vanntrykk og temperatur er OK</label>
        <label><input type="checkbox" name="vvs3"> Ventilasjon fungerer og filtrene er rene</label>
        <label><input type="checkbox" name="vvs4"> Kj√∏ling og varme fungerer</label>
      </div>

      <div class="card">
        <h2><i class="fa-solid fa-broom"></i> 5. Renhold og hygiene</h2>
        <label><input type="checkbox" name="rh1"> Avfallsh√•ndtering fungerer</label>
        <label><input type="checkbox" name="rh2"> Sanit√¶ranlegg er rene</label>
        <label><input type="checkbox" name="rh3"> Renholdsrutiner f√∏lges</label>
        <label><input type="checkbox" name="rh4"> S√•pe og papir er tilgjengelig</label>
      </div>

      <div class="card">
        <h2><i class="fa-solid fa-accessible-icon"></i> 6. Universell utforming</h2>
        <label><input type="checkbox" name="uu1"> Inngang er trinnfri eller tilrettelagt</label>
        <label><input type="checkbox" name="uu2"> Tilgjengelig toalett for rullestolbrukere</label>
        <label><input type="checkbox" name="uu3"> Informasjonsskilt er lett lesbare</label>
        <label><input type="checkbox" name="uu4"> Tilrettelegging for synshemmede finnes</label>
      </div>

      <!-- Notater -->
      <div class="card">
        <h2><i class="fa-solid fa-note-sticky"></i> Notater</h2>
        <textarea name="notater" rows="4" placeholder="Skriv notater eller observasjoner her..."></textarea>
      </div>

      <!-- Knappene -->
      <div class="buttons">
        <button type="button" onclick="lagre()">üíæ Lagre</button>
        <button type="button" onclick="hent()">üîÑ Hent</button>
        <button type="button" onclick="nullstill()">üóëÔ∏è Nullstill</button>
        <button type="button" onclick="eksporterPDF()">üìÑ PDF</button>
        <button type="button" onclick="eksporterExcel()">üìä Excel</button>
      </div>
    </form>
  </div>

  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const n√∏kkel = 'egenkontroll-data';

    function lagre() {
      const data = {};
      [...document.forms[0].elements].forEach(el => {
        if (el.name) data[el.name] = el.type === 'checkbox' ? el.checked : el.value;
      });
      localStorage.setItem(n√∏kkel, JSON.stringify(data));
      alert('‚úîÔ∏è Lagret!');
    }

    function hent() {
      const data = JSON.parse(localStorage.getItem(n√∏kkel) || '{}');
      [...document.forms[0].elements].forEach(el => {
        if (data.hasOwnProperty(el.name)) {
          if (el.type === 'checkbox') el.checked = data[el.name];
          else el.value = data[el.name];
        }
      });
    }

    function nullstill() {
      if (confirm('Slette all lagret data?')) {
        localStorage.removeItem(n√∏kkel);
        document.forms[0].reset();
      }
    }

    async function eksporterPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });
      const data = JSON.parse(localStorage.getItem(n√∏kkel) || '{}');
      let y = 40;

      doc.setFontSize(16);
      doc.text('Egenkontroll n√¶ringsbygg', 40, y);
      y += 30;

      const seksjoner = [
        ['1. Bygg', ['bygg1','bygg2','bygg3','bygg4','bygg5']],
        ['2. Brann', ['brann1','brann2','brann3','brann4','brann5']],
        ['3. Elektrisk', ['el1','el2','el3','el4','el5']],
        ['4. VVS/Ventilasjon', ['vvs1','vvs2','vvs3','vvs4']],
        ['5. Renhold', ['rh1','rh2','rh3','rh4']],
        ['6. Universell utforming', ['uu1','uu2','uu3','uu4']],
      ];

      doc.setFontSize(12);
      for (const [title, keys] of seksjoner) {
        doc.setFont(undefined, 'bold'); doc.text(title, 40, y); y += 20;
        doc.setFont(undefined, 'normal');
        for (const key of keys) {
          doc.text(`‚Ä¢ ${key}: ${data[key] ? '‚úÖ' : '‚ùå'}`, 60, y);
          y += 18; if (y > 750) { doc.addPage(); y = 40; }
        }
        y += 10;
      }

      if (data.notater) {
        doc.setFont(undefined, 'bold');
        doc.text('üìù Notater', 40, y); y += 20;
        doc.setFont(undefined, 'normal');
        const lines = doc.splitTextToSize(data.notater, 480);
        doc.text(lines, 60, y); y += lines.length * 18;
      }

      y += 30;
      doc.setFont(undefined, 'bold');
      doc.text('Signatur og dato', 40, y); y += 20;
      doc.setFont(undefined, 'normal');
      doc.text(`üñäÔ∏è Utf√∏rt av: ${data.signatur || ''}`, 60, y); y += 18;
      doc.text(`üìÖ Dato: ${data.kontrolldato || ''}`, 60, y);

      doc.save('egenkontroll.pdf');
    }

    function eksporterExcel() {
      const data = JSON.parse(localStorage.getItem(n√∏kkel) || '{}');
      const rows = [];

      const seksjoner = {
        '1. Bygg': ['bygg1','bygg2','bygg3','bygg4','bygg5'],
        '2. Brann': ['brann1','brann2','brann3','brann4','brann5'],
        '3. Elektrisk': ['el1','el2','el3','el4','el5'],
        '4. VVS/Vent': ['vvs1','vvs2','vvs3','vvs4'],
        '5. Renhold': ['rh1','rh2','rh3','rh4'],
        '6. Universell utforming': ['uu1','uu2','uu3','uu4']
      };

      for (const [title, keys] of Object.entries(seksjoner)) {
        rows.push({ Seksjon: title });
        for (const key of keys) {
          rows.push({ Punkt: key, Status: data[key] ? 'OK' : 'Mangler' });
        }
        rows.push({});
      }

      rows.push({ Notater: data.notater || '' });
      rows.push({ Signatur: data.signatur || '', Dato: data.kontrolldato || '' });

      const ws = XLSX.utils.json_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Egenkontroll');
      XLSX.writeFile(wb, 'egenkontroll.xlsx');
    }

    window.onload = hent;
  </script>
</body>
</html>
